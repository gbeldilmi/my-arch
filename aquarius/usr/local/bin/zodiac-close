#!/usr/bin/env bash

function _beep() {
  echo -e '\a' > /dev/console
}

function _close_backup() {
  umount -l /backup && echo "Backup unmounted"
  cryptsetup luksClose backup && echo "Backup closed"
}

function _close_zodiac() {
  umount -l /zodiac && echo "Zodiac unmounted"
  cryptsetup luksClose zodiac && echo "Zodiac closed"
  exportfs -arv
}

if [ "$EUID" -ne 0 ]
then
  echo "Please run as root"
else
  _close_backup
  _close_zodiac
fi

unset -f _beep
unset -f _close_backup
unset -f _close_zodiac
